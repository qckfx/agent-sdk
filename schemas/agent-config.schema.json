{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AgentConfig",
  "type": "object",
  "required": ["environment"],
  "additionalProperties": false,

  "properties": {
    "environment": {
      "description": "Repository execution environment",
      "oneOf": [
        {
          "type": "object",
          "required": ["type"],
          "additionalProperties": false,
          "properties": {
            "type": { 
              "const": "local",
              "description": "Run directly in the host environment (experimental)"
            }
          }
        },
        {
          "type": "object",
          "required": ["type"],
          "additionalProperties": false,
          "properties": {
            "type": { "const": "docker" }
          }
        },
        {
          "type": "object",
          "required": ["type"],
          "additionalProperties": false,
          "properties": {
            "type": { "const": "remote" }
          }
        }
      ]
    },

    "defaultModel": { 
      "type": "string",
      "description": "Default model to use when not supplied in processQuery call"
    },
    
    "logLevel": { 
      "type": "string",
      "enum": ["debug", "info", "warn", "error"],
      "default": "info",
      "description": "Log level for the agent"
    },
    
    "permissionMode": { 
      "type": "string",
      "enum": ["interactive", "auto", "manual"],
      "default": "interactive",
      "description": "Tool permission handling mode"
    },

    "description": {
      "type": "string",
      "description": "A description of the agent. This is used as the tool description given to the calling LLM if this is a sub-agent. Otherwise it is only useful for those reading the json and is unused in the runtime."
    },
    
    "allowedTools": { 
      "type": "array", 
      "items": { "type": "string" },
      "description": "List of tool IDs that are allowed to be used"
    },
    
    "cachingEnabled": { 
      "type": "boolean", 
      "default": true,
      "description": "Whether tool execution caching is enabled"
    },

    "systemPrompt": {
      "description": "Custom system prompt provided either inline as a string or via an external file path.",
      "oneOf": [
        { "type": "string" },
        {
          "type": "object",
          "required": ["file"],
          "additionalProperties": false,
          "properties": {
            "file": { 
              "type": "string", 
              "description": "Relative or absolute path to a text file containing the system prompt (experimental: requires experimentalFeatures.promptFiles = true)" 
            }
          }
        }
      ]
    },



    "tools": {
      "type": "array",
      "description": "Ordered list of tools that the agent can use. Each entry can be:\n        1. A string – the name of a built-in tool, e.g. 'BashTool'.\n        2. An object with { name, configFile } – declares a sub-agent that will be exposed as a tool.",
      "items": {
        "oneOf": [
          { "type": "string" },
          {
            "type": "object",
            "required": ["name", "configFile"],
            "additionalProperties": false,
            "properties": {
              "name": { "type": "string" },
              "configFile": { "type": "string", "description": "Path to the JSON configuration file containing the sub-agent definition" }
            }
          }
        ]
      }
    },

    "experimentalFeatures": {
      "type": "object",
      "description": "Opt-in flags for unstable features that may change without notice.",
      "additionalProperties": false,
      "properties": {
        "subAgents": {
          "type": "boolean",
          "description": "Enable experimental support for sub-agents exposed as tools.",
          "default": false
        },

        "promptFiles": {
          "type": "boolean",
          "description": "Enable experimental support for loading the systemPrompt from an external file via { \"file\": \"path\" } syntax.",
          "default": false
        },

        "localEnvironment": {
          "type": "boolean",
          "description": "Enable experimental support for executing the agent directly in the host environment (type = 'local').",
          "default": false
        }
      },
      "default": {}
    }
  }
}
